

# 一、介绍

在上个世纪，维也纳的维也纳技术大学招收了一个名为数据工程和统计学的学士课程。基本上，内容与现在常用的术语**数据科学**完全相关。课程中包括计算机科学领域面向数据的讲座，如存储和检索数据、编程和数据安全，以及统计应用讲座，如多元统计、生物统计、金融统计、统计学习和官方统计。我们的学生太少了，几年后这门课被取消了。16 年后，情况完全变了。过去几年，世界各地都开设了新的数据科学学士和硕士课程。大学发现他们必须提供数据科学方面的研究，因为这个行业需要这方面的专家，但近年来统计方面的发展几乎都来自一个叫做**计算统计**的领域。统计学是计算数据的原始形式，计算统计学将这一点发挥到了极致，方法和工具是以高度依赖数据的方式开发的，使用并开发了现代计算工具。计算统计学和数据科学密切相关。计算统计学涵盖了广泛的数据科学、专有数据管理和数据安全问题。计算统计学(因此也包括数据科学)自 80 年代以来变得非常流行，它很可能是当今统计学中最有影响力的领域。在计算统计学领域，不仅开发了新的方法，而且还在软件中实现——现在几乎只在古老但现代的**软件环境 R** 中实现。

当你的工作由数据驱动时，数据科学看起来像是一个的好术语，与计算统计学相比，数据在方法和算法开发方面的分量较弱，但有许多与存储、检索和处理数据集相关的纯计算机科学主题。它在各个方面也不同于计算统计学。例如，在数据可视化领域，纯过程相关的可视化(例如，引擎中的气流)也是数据科学中的一个主题，但不是计算统计学中的主题。

维基百科将数据科学定义为这样一个领域:

> *“融合了各种元素并建立在许多领域的技术和理论之上，包括数学、统计学、数据工程、模式识别和学习、高级计算、可视化、不确定性建模、数据仓库和高性能计算，目标是从数据中提取意义并创建数据产品。”*

数据科学是整个建模过程的管理，从数据收集、存储和管理数据、数据预处理(编辑、插补)、数据分析和建模，到自动化报告和呈现结果，所有这些都以可重现的方式进行。因此，这也是一项跨学科的研究，通过使用计算机科学中的许多元素以及一般的主题技能，从统计数据中提取意义。从这个意义上说，数据科学是统计学的延伸和延续。数据科学家使用统计学和面向数据的计算机科学工具来解决他们面临的问题。

**统计模拟**是数据科学中一个必不可少的领域。这本书的核心问题是模拟分布和数据集，推断统计的蒙特卡罗方法，并提出计算机密集型方法的解决方案。这本书讨论了统计模拟，随机数模拟，重采样，蒙特卡罗方法，通过模拟实验解释的统计理论，基于代理的微观模拟和系统动力学的各个领域。我们的目标是把一本书交到读者手中，这本书解释方法，给出使用这些方法的建议，并提供计算工具来解决统计模拟和计算机密集型方法中的常见问题。

在这本书里，理论不仅仅是解释。该理论也可以用 R 软件环境中的示例来理解。读者将掌握 R 软件环境。在获得该领域流行方法的背景知识后，读者将看到 R 中的应用程序，以便更好地理解这些方法，并在处理真实世界的数据和真实世界的问题时获得经验。

r 本身非常适合进行模拟。应该提到的是，R 的基础知识不是本书的主题，但是高级数据操作和高级可视化工具在 R 中有所介绍。因此，读者不应该是一个完全的 R 新手，如果是这样，应该先阅读一篇非常基础的 R 介绍。

读者将简要了解数据驱动模拟和重采样方法的问题和可能性。

# 什么是模拟，应用在哪里？

统计模拟是一种在计算机上进行实验的数值方法，目的是以数据驱动的方式解决数学问题。

每个*实验*分两步进行:

1.  随机抽取结果。
2.  随后对绘制的数据应用估计函数。

随机抽取是通过模拟随机数的方式进行的，例如由选定的随机数发生器产生的数字。

模拟以不同的方式应用。它应用于**采样**中，通过观察随机对象的许多实现来收集关于随机对象的信息(Kroese 等人，2014)。

随着计算能力的不断提高，新方法和算法的不断开发，不仅有机会进行创新研究，而且有机会通过**和**基于代理的建模**设计更好的社会和经济政策和计划，其中状态根据定义的转移概率随时间变化。再比如 **系统动力学**的区域，描述的是种群或个体的相互作用。这两个主题都是第 11 章、*系统动力学和基于代理的模型*的一部分。**

**通过模拟实验，人们甚至可以展示概率论的概念和统计学的基本定理。可以解释(弱与强)*大数定律*。我们可能会反复做一些相关概率机制的实验。这些实验的结果是随机的——随机事件的结果无法确定，但从长远来看，我们知道其性质。扔硬币是最简单的例子。数理统计中最基本的定理，中心极限定理，也可以通过模拟展示。使用模拟实验，读者将能够充分理解这一重要定理，而用数学证明则需要非常详细的质量和概率论知识。在[第 6 章](ch06.xhtml "Chapter 6. Probability Theory Shown by Simulation")、*通过模拟展示概率理论*中提供了更多关于模拟展示统计学基础知识的信息。**

**统计模拟也用于显示不同条件下估算方法的特性。一个例子是，在不同类型的缺失值模式下，估计量如何表现，或者异常值如何破坏估计量。当样本是用复杂抽样设计从有限总体中抽取时，抽样设计对感兴趣的估计量的影响可以用基于设计的模拟来显示。基于模型的仿真和基于设计的仿真都在[第十章](ch10.xhtml "Chapter 10. Simulation with Complex Data")、*复杂数据仿真*中给出。还讨论了如何针对不同类型的问题模拟数据。这涵盖了基于设计的模拟所需的高维数据和复杂的合成群体。**

**通常，当统计学家谈论模拟时，他们指的是**蒙特卡洛模拟**。蒙特卡罗模拟方法使用重复随机抽样来模拟零假设或模拟来自模型的数据，其中估计函数应用于模拟数据。**

**蒙特卡洛模拟方法是也是在**贝叶斯统计**中必不可少的，其中**马尔可夫链蒙特卡洛** ( **MCMC** )方法用于从后验分布中采样参数值(另见 Kroese 等人，2014)。这将在[第 4 章](ch04.xhtml "Chapter 4. Simulation of Random Numbers")、*随机数模拟*中详细讨论。一般来说，手头有一个优秀的随机数生成器是至关重要的，它允许您模拟均匀分布的值。此外，将均匀分布转换为感兴趣的分布也至关重要。我们可以用反演、拒绝采样或 MCMC 方法来实现这一点；参见[第 4 章](ch04.xhtml "Chapter 4. Simulation of Random Numbers")、*随机数模拟*。**

**蒙特卡洛模拟方法通常也是估算某些数值的核心，但尤其是估算**统计不确定性**。事实证明([第六章](ch06.xhtml "Chapter 6. Probability Theory Shown by Simulation")，*模拟显示的概率论*)几乎没有数学被用来表达任何复杂估计量的统计不确定性。蒙特卡罗模拟方法是一种数据驱动的计算工具。它是数据科学家进行统计推断的完美工具，而不会迷失在数学世界中。**

**蒙特卡洛模拟的另一个应用是**多维积分**，它可以通过蒙特卡洛技术求解，通常是通过从定义积分的区间中抽取随机数。与此密切相关的是数值**优化**。这里，蒙特卡罗方法可用于首先使用随机方法解决具有复杂目标函数的优化问题。引入随机性的目的是避免在非凸(或非凹)优化函数中搜索最优值时收敛/陷入局部最优值(更多信息请参见第五章、*蒙特卡洛优化方法*)。**

**蒙特卡罗模拟的伟大之处在于其过程简单，与估算者/感兴趣的估算的复杂性无关。即使是最复杂的蒙特卡罗模拟也可以分解成简单的步骤:**

1.  **确定一个数学模型——你想要应用的估计。**
2.  **定义模型中的参数。**
3.  **根据这些参数创建随机数据。通常，我们在感兴趣的条件下生成独立的数据集。**
4.  **模拟和分析你的评估结果。这通常通过计算估计量/检验统计量的数值来完成。在原始数据上，这个应该是 T( **X** )。对于每个模拟数据集，我们得到![What is simulation and where is it applied?](Images/B05113_01_03.jpg)，即每个模拟数据的估计量的数值。如果足够大，![What is simulation and where is it applied?](Images/B05113_01_03.jpg)的分布给出了估计量/测试的真实抽样分布的良好近似值。此外，估计的样本均值是真实均值的估计。这个分布的 0，025 和 0，975 分位数是 T( **X** )点估计的置信区间的估计值。**

**一般来说，通过蒙特卡罗模拟，我们可以近似估计量或检验统计量的抽样分布。相关条件的特定集合通常是从原始数据拟合的参数和来自零假设的条件。通过蒙特卡罗模拟，我们可以成功地表达估计量的统计不确定性，或者获得假设检验的相关值(例如， *p 值*)。**

**

# 为什么要使用模拟？

模拟可以节省大量时间，并为我们的问题提供非常准确的答案。

统计推断通常由渐近正态理论处理，它可以提供标准误差的公式，允许我们围绕点估计构造置信区间。对于算术平均值的简单估计量的简单情况，我们可以立即为具有 *n* 值的观测向量 *x* 选择公式![Why use simulation?](Images/B05113_01_05.jpg)，算术值![Why use simulation?](Images/B05113_01_06.jpg)和 *s* 是 *x* 的标准偏差。然而，这个表示算术平均值置信区间的公式只适用于从总体中简单随机抽样的独立同分布样本。然而，在许多情况下，感兴趣参数的(渐近)分布可能是未知的，并且我们通常没有专业知识来推导出甚至是一个公式的近似值来表示感兴趣的估计量的标准误差。例如，这可能适用于 Huber 均值(Huber 1981 ),该均值来自采用多阶段整群抽样设计抽样的数据。换句话说，如果感兴趣的量是数据的非常复杂的函数，或者如果数据具有非常复杂的性质，我们可能能够从蒙特卡罗模拟的使用中受益匪浅。即使统计文献中可能存在表示置信区间的公式，我们也可能不知道。

一个非常突出的**重采样方法**就是**自举**，在[第七章](ch07.xhtml "Chapter 7. Resampling Methods")、*重采样方法*中密集讨论。在这种方法中，参数估计的采样分布是通过从当前数据进行替换的重复采样以及从每个采样数据集中重新计算参数估计来模拟的。这些估计值的分布表示估计值的可变性，因此这种分布可以用来表示置信区间。

这种方法与假设检验非常相似。对于一个测试，测试统计量的分布并不总是已知的。使用蒙特卡洛方法进行测试时，数据以模拟零假设的方式进行模拟，数据生成的参数来自经验数据。对数据计算检验统计量，并与重复模拟的数据进行比较。这是第 8 章、*中[的一个简单的话题，重采样方法和蒙特卡洛测试](ch08.xhtml "Chapter 8. Applications of Resampling Methods and Monte Carlo Tests")*、*蒙特卡洛测试*的应用接收测试的 *p 值*。



# 模拟和大数据

大的非结构化数据现在经常被分析，或者作为辅助信息。在大数据上运行模拟是一项挑战。

大数据可能太大，以至于不适合台式计算机的内存。每当这种情况发生时，基本上有三个选项可供选择。第一种选择是使用一个更强大的服务器和更大的内存来进行计算。其次，数据也可以有效地存储在数据库中，我们连接到数据库进行分析。通常，只有数据的子集是感兴趣的，所以我们可以只抓取数据库中感兴趣的部分，将其导入 R，进行分析，然后将结果导出回数据库。因为 R 具有优秀的特性和 API 来连接众所周知的数据库，所以这是推荐的方法。第三，首先聚合和子集化你的数据。你的分析很可能不需要这么详细的信息。举个例子，假设你要分析道路交通数据。高速公路上的测量单位通常报告速度、与下一辆车的距离、使用的车道和车辆的种类。如果是这样的话，数据将会非常庞大。然而，对于测量故障的分析，聚合数据并分析 1 或 5 分钟间隔的数据就足够了。

一旦数据集变大，像 Bootstrap 这样的重采样方法可能会导致很长的计算时间。通常的方法是重复采样数据，估计感兴趣的统计量，并保存结果。每当模拟可以在不同的设置下重新运行时，可以改变这种方法。对于诸如 Bootstrap 的方法，可以为每个 Bootstrap 样本存储附加向量，该向量包含关于样本多久被包括在 Bootstrap 样本中的信息。因此，代替*存储*引导样本，我们存储矢量 *0，1，...*表示一个单元是否包含在 Bootstrap 样本中(以及包含的频率)。使用这种方法，引导样本必须是精选的。当 Bootstrap 样本选择由于特殊的抽样设计而具有更复杂的性质时，这种方法特别有用，并且应该再次重新运行模拟。

如果重复进行估计，如在蒙特卡罗方法中，在可用的软件中快速实现估计器是非常重要的。建议对所有内容进行矢量化处理，这意味着应用于向量或任何其他数据结构的任何函数调用都直接对其所有值/元素进行操作。因此，这个*循环*用 C 或 C++等编译语言实现是至关重要的，base R 的更多基本函数也是如此。使用外语通常比直接使用非编译、解释的 R 语言要有效得多。在向量、矩阵或数据帧上适当实现类似 apply 的函数甚至可以非常简单地并行化。诀窍是使用来自 R 包并行(R Core Team 2015)的调用`mclapply`而不是`lapply`。

重采样方法可以在并行进程中轻松运行。蒙特卡罗技术最初是为只有一个处理器的机器设计的。凭借当今的高性能计算能力，通常可以通过使用多个并行运行的处理器来完成计算(Kroese 等人，2014)。蒙特卡洛技术在并行处理框架中高效地执行。例如，在 R 中，并行运行蒙特卡罗方法只需要很少的修改。然而，当数据集变大时，并行计算可能只会比 Linux 或 OS X 操作系统中的单核计算更快，因为两者都支持*分叉*，而微软 Windows 不支持相同程度的分叉。

一个相关的问题是将有效的随机数生成技术用于并行计算。必须保证独立工作者使用的随机数是独立产生的，否则工作者将返回相同的结果。为了促进可重复的研究，因此有必要向所有工作人员提供不同的随机数初始化(另见 Schmidberger 等人，2009)。例如，包 rlecuyer (Sevcikova 和 Rossini 2015)支持这些问题。



# 选择正确的模拟技术

坏消息是没有通用的指导，也没有通用的模拟方法。正确的模拟技术的选择取决于潜在的问题、数据集和研究的目的。

我们已经提到了模拟在哪些领域发挥了作用。根据感兴趣的领域，考虑不同的技术。对于贝叶斯分析，在使用重采样技术的一般推断统计之间，以及在优化进入主题时，方法是不同的。当群体或个体的相互作用成为焦点时，或者当需要在个体水平上预测未来(微观模拟)时，这些方法完全改变。

然而，一些一般性的问题可以为选择正确的技术提供一点指导。这在*表 1.1* 中进行了说明。当然，经常会出现无法做出明确决定的情况。例如，如果您处理一个样本，优化技术可能会因为几个原因而被使用，但是优化的主要目的是更一般的。它可以应用于样本或总体数据。另一个例子包括，例如，在基于主体的微观模拟中，当然可以比较模型，但这不是主要目的。因此，这个表应该只给出一个非常粗略的基本问题分类方法。应该清楚的是，优化方法、系统动力学方法和基于主体的微观模拟技术可能不同于为表达估计量的不确定性而开发的方法，如重采样方法。

下表描述了选择正确的模拟技术、**蒙特卡罗** ( **MC** )技术和重采样技术；**马尔可夫链** **蒙特卡洛** ( **MCMC** )方法；MC 测试蒙特卡罗技术应用于假设检验，**优化**(**)，**系统** **动力学** ( **SD** )，**基于主体的** **建模** ( **ABM** )，**基于设计的** **模拟**(**

| 

问题

 | 

是

 | 

不

 |
| --- | --- | --- |
| 你有样品吗？ | MC，MC 测试，MBS，DBS | ABM，SD |
| 可变性/随机性重要吗？ | MC，MC 测试，MBS，DBS | ABM，SD |
| 观察次数多吗？ | 反弹道导弹 | 标清，MCMC |
| 你应用假设检验吗？ | MC 测试 | ABM、DBS、SD、Opt |
| 样本是从有限的人群中抽取的吗？ | 直播卫星 | 相互广播公司（Mutual Broadcasting System 的缩写） |
| 你和大众一起工作吗？ | 反弹道导弹，被占领土，标准偏差 | MC，MC 测试 |
| 要不要对比模特？ | 主持人 | 反弹道导弹，标准偏差，被占领土 |
| 你应用贝叶斯统计吗？ | MCMC | 标清，可选 |
| 是否需要模拟某些分布？ | RN，MCMC | 标清，可选 |
| 概率论是主要问题吗？ | 美国弹道导弹公司 | MC、MBS、DBS |
| 有需要优化的地方吗？ | 选择 | MC，MC 测试，MBS |
| 个体内部的动态行为规则。 | 标清，弹道导弹 | 所有其他 |
| 随着时间的推移，系统会发生变化吗？ | 南达科他州 | 所有其他 |
| 感兴趣的时间范围可以很长吗？ | ABM，SD | 所有其他 |

**请欣赏前面提到的所有章节，在*图 1.1* 中用 R 的包动画(易慧 2013)模拟一场惬意的燃烧的火，并和 R 一起开始探索*模拟数据科学中的所有不同问题:***

**![Choosing the right simulation technique](Images/B05113_01_01.jpg)

图 1.1:为了你的舒适，模拟燃烧的火的快照** 

**要运行燃烧的火模拟，看看这个网站上的代码:[http://yihui . name/en/2009/06/simulation-of-burning-fire-in-r/](http://yihui.name/en/2009/06/simulation-of-burning-fire-in-r/)。**

**

# 总结

模拟实验大多依赖于数据，因此非常适合数据科学家。本章提到了不同种类的模拟技术。它们将在下一章中详细讨论。我们提到，模拟几乎可以应用于任何地方，以显示方法的属性和性能，进行预测，并评估统计不确定性。我们了解到，不存在通用的方法，对于不同的任务、数据集和问题，存在完全不同的方法。选择正确的模拟方法取决于数据科学家和统计学家。

每当计算能力成为一个问题时，请记住，几乎任何模拟都可以以并行方式运行，现代软件已经为这项任务做好了准备。

实际上，人们不应该问这样的问题“你为什么使用模拟？”对于应用模拟技术的人，而是“你为什么不用模拟？”给不知道的人。



# 参考文献

*   Eddelbuettel 和 R. Franç ois。2011，“Rcpp:无缝的 R 和 C++集成。”*统计软件杂志 40(8):1–18*。
*   Huber，P.J. 1981，*稳健统计学*，Wiley。
*   Kroese，D.P .，T. Brereton，T. Taimre 和 Z.I. Botev。2014.“为什么蒙特卡罗方法在今天如此重要，”*威利跨学科评论:计算统计学 6 (6)。约翰·威利&父子公司:386–92。*
*   r 核心团队。2015. *R:统计计算的语言和环境*。奥地利维也纳:R 统计计算基金会。https://www.R-project.org/[。](https://www.R-project.org/)
*   Schmidberger，s .，M. Morgan，D. Eddelbuettel，H. Yu，L. Tierney 和 U. Mansmann。2009，“R 并行计算的现状”，*统计软件学报* 31 (1)。
*   sevcikova h 和 T. Rossini。2015. *Rlecuyer: R 接口多流*、【https://CRAN.R-project.org/package=rlecuyer】到 RNG。
*   易慧，X. 2013。“Animation:一个用于创建动画和演示统计方法的 R 包”，*统计软件杂志*53(1):1–27。****